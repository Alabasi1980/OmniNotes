
# ๐ ุฏููู ุงููุทูุฑ - ูุดุฑูุน OmniNotes

## 1. ูุธุฑุฉ ุนุงูุฉ (Overview)
ูุฐุง ุงูุชุทุจูู ูู ูุธุงู "Second Brain" ูุฅุฏุงุฑุฉ ุงูููุงุญุธุงุช ูุงููุนุฑูุฉ. ุชู ุจูุงุก ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Frontend) ุจุงุณุชุฎุฏุงู **Angular v18+** ูุน ุงุนุชูุงุฏ ุฃุญุฏุซ ุชูููุงุช ุงูุฅุทุงุฑ (Signals, Standalone Components, Tailwind CSS).

ูุชููุฒ ุงูุชุทุจูู ุจุชุตููู ููุฏุณู ูุฑู (Flexible Architecture) ูุณูุญ ูู ุจุงูุนูู ูู ุจูุฆุชูู ูุฎุชููุชูู ุฏูู ุชุนุฏูู ุฌููุฑู ูู ุงูููุฏ:
1. **ุจูุฆุฉ ุงูุชุทููุฑ (Mock Mode):** ูุนูู ุญุงูููุง ุนูู ุงููุชุตูุญ ููุท ุจุงุณุชุฎุฏุงู `LocalStorage`.
2. **ุจูุฆุฉ ุงูุฅูุชุงุฌ (Production Mode):** ุฌุงูุฒ ููุฑุจุท ูุน `ASP.NET Core Web API` ู `SQL Server`.

---

## 2. ุงูููููุฉ ุงูููุฏุณูุฉ (Architecture)

ูุชุจุน ุงูุชุทุจูู ููุท **Service-Repository Pattern** ููุตู ููุทู ุงูุนุฑุถ ุนู ููุทู ุงูุจูุงูุงุช.

```text
[ Components (UI) ]
       โฌ
   (ูุทูุจ ุงูุจูุงูุงุช)
       โฌ
[ DbService (Facade) ]
       โฌ
   (ูุฏูุฑ ุงูุญุงูุฉ State Management ุจุงุณุชุฎุฏุงู Signals)
       โฌ
[ ApiServices (Data Access) ] โฌโฌโฌ (ููุง ุชููู ููุทุฉ ุงูุชุญููู)
       โฌ
---------------------------------
|  ูุณุงุฑ 1 (ุญุงูููุง)  |  ูุณุงุฑ 2 (ูุณุชูุจูุงู) |
|   LocalStorage    |   HTTP Client     |
---------------------------------
```

### ุงููููุงุช ุงูุฃุณุงุณูุฉ ููุจูุงูุงุช:
*   `src/services/db.service.ts`: ุงูุฎุฏูุฉ ุงูุฑุฆูุณูุฉ ุงูุชู ุชุชุนุงูู ูุนูุง ุงูููููุงุช.
*   `src/services/api/notes.service.ts`: ูุณุคูู ุนู ุนูููุงุช CRUD ููููุงุญุธุงุช.
*   `src/services/api/catalogs.service.ts`: ูุณุคูู ุนู ุงูุชุตูููุงุช.
*   `src/services/api/attachments.service.ts`: ูุณุคูู ุนู ุฑูุน ุงููููุงุช.
*   `src/services/api/ai.service.ts`: ูุณุคูู ุนู ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุฌุฏูุฏ).

---

## 3. ุงูุงูุชูุงู ุฅูู SQL Server (Backend Migration)

ูุชุญููู ุงูุชุทุจูู ูู ุงูุนูู ุงููุญูู (Local) ุฅูู ุงูุนูู ูุน ุงูุณูุฑูุฑุ ุงุชุจุน ุงูุฎุทูุงุช ุงูุชุงููุฉ ุจุฏูุฉ:

### ุฃ) ูุชุทูุจุงุช ุงูู Backend
ูุฌุจ ุจูุงุก ูุดุฑูุน **ASP.NET Core Web API** ูููุฑ ุงูู Endpoints ุงูุชุงููุฉ ุจููุณ ููููุฉ ุงูุจูุงูุงุช (JSON Models):

**1. Notes Controller (`/api/notes`)**
- `GET /api/notes`: ุฅุฑุฌุงุน ูุตูููุฉ ูู ุงูููุงุญุธุงุช.
- `GET /api/notes/{id}`: ุฅุฑุฌุงุน ููุงุญุธุฉ ูุงุญุฏุฉ.
- `POST /api/notes`: ุฅูุดุงุก ููุงุญุธุฉ ุฌุฏูุฏุฉ.
- `PUT /api/notes/{id}`: ุชุนุฏูู ููุงุญุธุฉ.
- `DELETE /api/notes/{id}`: ุญุฐู ููุงุญุธุฉ.

**2. Catalogs Controller (`/api/catalogs`)**
- `GET /api/catalogs`
- `POST /api/catalogs`
- `DELETE /api/catalogs/{id}`

**3. Attachments Controller (`/api/attachments`)**
- `POST /api/attachments/upload`:
  - **Input:** `Multipart/form-data` ูุน ููุชุงุญ ุจุงุณู `file`.
  - **Logic:** ุญูุธ ุงูููู ูู ูุฌูุฏ (ูุซูุงู `wwwroot/uploads`) ูุญูุธ ุจูุงูุงุชู ูู ุฌุฏูู Attachments.
  - **Output:** ูุงุฆู `Attachment` ุญูุซ ูููู ุญูู `data` ูู ุงูุฑุงุจุท ุงููุงูู ููููู (ูุซูุงู `/uploads/img1.png`).

**4. AI Controller (`/api/ai`)**
- `POST /api/ai/suggest-tags`:
  - **Input:** `{ "content": "string" }`
  - **Logic:** ูุณุชุฏุนู Gemini API ูู ุงูุณูุฑูุฑ (ุจุงุณุชุฎุฏุงู ุงูู Key ุงููุญููุธ ุขูููุง ูู ุงูุณูุฑูุฑ).
  - **Output:** `{ "tags": ["tag1", "tag2"] }`

### ุจ) ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช (SQL Server)
ุจูุงุกู ุนูู ูุนูููุงุชูุ ูุฌุจ ุฃู ูููู ููู `appsettings.json` ูู ูุดุฑูุน ุงูู ASP.NET Core ูุงูุชุงูู:

```json
"ConnectionStrings": {
  "DefaultConnection": "Server=MAJED\\MJDSQLSERVER;Database=OmniNotesDb;User Id=sa;Password=013590;TrustServerCertificate=True;"
}
```

### ุฌ) ุชูุนูู ุงูุฑุจุท ูู Angular (ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ)

ูุง ุชุญุชุงุฌ ูุชุบููุฑ ุฃู ููุฏ ูู ุงูู Components. ููุท ุงุฐูุจ ุฅูู ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช ูู ุงูุชุทุจูู (`/settings`) ููู ุจุชูุนูู ุฎูุงุฑ **"Use Real API (SQL Server)"**.

---

## 4. ุงููุดุฑ ุนูู IIS (IIS Deployment)

ูุชุดุบูู ุงูุชุทุจูู ุนูู ุณูุฑูุฑ IISุ ุชู ุฅุถุงูุฉ ููู `web.config` ุฌุงูุฒ ูู ุงููุดุฑูุน. ุงุชุจุน ุงูุฎุทูุงุช ุงูุชุงููุฉ:

### ุงููุชุทูุจุงุช ุงููุณุจูุฉ ุนูู ุงูุณูุฑูุฑ
1. **IIS Installed.**
2. **IIS URL Rewrite Module:** (ูุงู ุฌุฏุงู) ูุฌุจ ุชุญูููู ูุชุซุจูุชู ููู ุชุนูู ููุงุนุฏ ุงูุชูุฌูู ูู `web.config`.

### ุฎุทูุงุช ุงููุดุฑ (Deployment Steps)

1. **ุจูุงุก ุงูุชุทุจูู (Build):**
   ูู ุจุชุดุบูู ุฃูุฑ ุงูุจูุงุก ูุฅูุชุงุฌ ูููุงุช ุงูุฅูุชุงุฌ (Production files). ุณุชููู ุงููููุงุช ุนุงุฏุฉ ูู ูุฌูุฏ `dist/omni-notes`.

2. **ูุณุฎ ุงููููุงุช:**
   ุงูุณุฎ ูุญุชููุงุช ูุฌูุฏ ุงูู Build (ุจูุง ูู ุฐูู ููู `web.config` ู `index.html`) ุฅูู ูุฌูุฏ ุงููููุน ุนูู ุงูุณูุฑูุฑ (ูุซูุงู `C:\inetpub\wwwroot\OmniNotes`).

3. **ุฅุนุฏุงุฏ ุงููููุน ูู IIS Manager:**
   - ุฃูุดุฆ "Add Website".
   - ุญุฏุฏ ุงููุณุงุฑ ุงูููุฒูุงุฆู (Physical Path) ูููุฌูุฏ ุฃุนูุงู.
   - ุญุฏุฏ ุงูู Port (ูุซูุงู 80 ุฃู 443).

4. **ุงูุชุนุงูู ูุน ุงูุชูุฌูู (Routing):**
   - ุญุงููุงู ุงูุชุทุจูู ูุณุชุฎุฏู `HashLocationStrategy` (`/#/note/1`). ูุฐุง ูุนูู ุงูุชุฑุงุถูุงู.
   - ุฅุฐุง ุฃุฑุฏุช ุงุณุชุฎุฏุงู ุฑูุงุจุท ูุธููุฉ (`/note/1`)ุ ูู ุจุฅุฒุงูุฉ `withHashLocation()` ูู ููู `index.tsx` ูุจู ุงูุจูุงุก. ููู `web.config` ุงููุฑูู ูุฌูุฒ ุจุงููุนู ููุชุนุงูู ูุน ูุฐุง ุงููุถุน ูุฅุนุงุฏุฉ ุชูุฌูู ุงูุทูุจุงุช ุฅูู `index.html`.

---

## 5. ูููุฐุฌ ุงูุจูุงูุงุช (Data Models)

ุนูุฏ ุจูุงุก ุฌุฏุงูู SQL ุฃู ูุฆุงุช C#ุ ุงูุชุฒู ุจูุฐู ุงูุชุณููุงุช ูุถูุงู ุชุทุงุจู ุงูู JSON.

### ููุงุญุธุฉ ูุงูุฉ: ูุงุจููุฉ ุงูุชูุณุน (Extensibility)
ุชู ุชุญุฏูุซ ุชุตููู ุงูุจูุงูุงุช ูุฏุนู ุฃููุงุน ุงูููุงุญุธุงุช ุงููุฑูุฉ. ุจุฏูุงู ูู ุฃุนูุฏุฉ ุซุงุจุชุฉ ููู ุฎุงุตูุฉ ูุฑูุฏุฉ (ูุซู `Solution` ุฃู `Url`)ุ ูุณุชุฎุฏู ุนููุฏุงู ูุงุญุฏุงู ูู ููุน JSON ูุชุฎุฒูู ุงูุจูุงูุงุช ุงููุตููุฉ.

### Note Model
```typescript
{
  id: string; (Guid)
  type: string; (Flexible string)
  title: string;
  content: string; (Markdown text)
  
  // JSON Column in SQL Server
  metadata: string (JSON); 
  // Example content: { "solution": "Fix it by...", "url": "https://..." }
  
  tags: string[]; (List/Array of strings or related table)
  catalogId?: string; (Nullable, Foreign Key)
  attachments: Attachment[]; (Child Table)
  createdAt: string; (DateTime ISO)
  updatedAt: string; (DateTime ISO)
  isArchived: boolean;
}
```

### Attachment Model
```typescript
{
  id: string;
  name: string;
  type: string; (MIME type e.g. 'image/png')
  data: string; (URL path in Production, Base64 in Dev)
}
```

---

## 6. ููุงุญุธุงุช ูููุทูุฑ ุงููุณุชูุจูู

1. **ุงูุตูุฑ ูุงููุฑููุงุช:**
   ุชู ุชุญุฏูุซ ุงูุชุทุจูู ูุฏุนู ุงูุฑูุน ุงููููุตู. ูู ุงููุถุน ุงูุญููููุ ุชุฃูุฏ ูู ุฃู ุงูู Backend ูุฑุฌุน ุฑุงุจุท ุงูููู ูู ุญูู `data` ูููุณ ูุญุชูู ุงูููู.

2. **CORS:**
   ุชุฃูุฏ ูู ุชูุนูู CORS ูู ูุดุฑูุน ุงูู ASP.NET Core ููุณูุงุญ ูู Angular (ุนุงุฏุฉ `http://localhost:4200`) ุจุงูุงุชุตุงู ุจุงูู API.

```csharp
app.UseCors(policy => policy.AllowAnyHeader().AllowAnyMethod().AllowAnyOrigin());
```

---

## 7. ุงูุฃูุงู ูุงูุชุนุงูู ูุน ุงููููุงุช (Security & Files)

ูุถูุงู ุญูุงูุฉ ุงูุณูุฑูุฑ ุนูุฏ ุชูุนูู ุงูู APIุ ูุฌุจ ุชูููุฐ ุงูุถูุงุจุท ุงูุชุงููุฉ ูู ููุฏ ุงูู Backend (C#):

1. **ุงูุชุญูู ูู ุงูุงูุชุฏุงุฏุงุช (MIME Validation):**
   - ูุง ุชุนุชูุฏ ููุท ุนูู ุงูู `Content-Type` ุงููุงุฏู ูู ุงููุชุตูุญ.
   - ูู ุจุฅูุดุงุก ูุงุฆูุฉ ุจูุถุงุก (Allowlist) ููุงูุชุฏุงุฏุงุช ุงููุณููุญุฉ: `.jpg`, `.png`, `.pdf`, `.txt`, `.md`, `.json`.
   - ุงุฑูุถ ุฃู ููู ุชูููุฐู (`.exe`, `.sh`, `.bat`).

2. **ุญุฌู ุงูููู (Size Limits):**
   - ุชู ุถุจุท ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Frontend) ูููุน ุงููููุงุช ุฃูุจุฑ ูู **10MB**.
   - ูุฌุจ ุชุฃููุฏ ูุฐุง ุงูููุฏ ูู ุงูุณูุฑูุฑ ุฃูุถูุง (ูู ุฅุนุฏุงุฏุงุช Kestrel ุฃู IIS).

3. **ููุน Path Traversal:**
   - **ุฎุทุฑ:** ูุง ุชูู ุฃุจุฏุงู ุจุญูุธ ุงูููู ุจุงุณุชุฎุฏุงู ุงูุงุณู ุงููุฑุณู ูู ุงููุณุชุฎุฏู ูุจุงุดุฑุฉ (`file.FileName`).
   - **ุงูุญู:** ุงุณุชุฎุฏู ุงุณู ุนุดูุงุฆู ุขูู. ูุซุงู:
     ```csharp
     var fileName = Guid.NewGuid().ToString() + Path.GetExtension(file.FileName);
     var savePath = Path.Combine(uploadsFolder, fileName);
     ```

4. **ุฅุนุฏุงุฏุงุช CORS:**
   - ูู ุจูุฆุฉ ุงูุฅูุชุงุฌุ ูุง ุชุณุชุฎุฏู `AllowAnyOrigin`.
   - ุญุฏุฏ ุงููุทุงู ุจุฏูุฉ: `WithOrigins("https://your-domain.com")`.
